!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function r(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?t(Object(n),!0).forEach((function(t){var r,i,u;r=e,i=t,u=n[t],(i=o(i))in r?Object.defineProperty(r,i,{value:u,enumerable:!0,configurable:!0,writable:!0}):r[i]=u})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function o(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}var i=new(function(){return e=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseUrl=t,this.headers=r},(t=[{key:"getUserInfo",value:function(){return fetch("".concat(this.baseUrl,"/users/me"),{headers:this.headers}).then((function(e){if(!e.ok)throw new Error("Server error: ".concat(e.status));return e.json()})).catch((function(e){return console.error("Error:",e)}))}},{key:"getInitialCards",value:function(){return fetch("".concat(this.baseUrl,"/cards"),{headers:this.headers}).then((function(e){if(!e.ok)throw new Error("Server error: ".concat(e.status));return e.json()})).catch((function(e){return console.error("Error:",e)}))}},{key:"modifyUsersInfo",value:function(e,t){return fetch("".concat(this.baseUrl,"/users/me"),{method:"PATCH",headers:r(r({},this.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:e,about:t})}).then((function(e){if(!e.ok)throw new Error("Server error: ".concat(e.status));return e.json()})).catch((function(e){return console.error("Error:",e)}))}},{key:"getNewCard",value:function(e,t){return fetch("".concat(this.baseUrl,"/cards"),{method:"POST",headers:r(r({},this.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:e,link:t})}).then((function(e){if(!e.ok)throw new Error("Server error: ".concat(e.status));return e.json()})).catch((function(e){return console.error("Error:",e)}))}},{key:"likeCard",value:function(e,t){var r=t?"PUT":"DELETE";return fetch("".concat(this.baseUrl,"/cards/likes/").concat(e),{method:r,headers:this.headers}).then((function(e){if(!e.ok)throw new Error("Server error: ".concat(e.status));return e.json()})).catch((function(e){console.error("Error: can't apply like",e)}))}},{key:"deleteCard",value:function(e){return fetch("".concat(this.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this.headers}).then((function(e){if(!e.ok)throw new Error("Server error: ".concat(e.status));return e.json()})).catch((function(e){return console.error("Error:",e)}))}},{key:"resetAvatar",value:function(e){return fetch("".concat(this.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r(r({},this.headers),{},{"Content-Type":"application/json"}),body:JSON.stringify({avatar:e})}).then((function(e){if(!e.ok)throw new Error("Server error: ".concat(e.status));return e.json()})).catch((function(e){return console.error("Error:",e)}))}}])&&n(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}())("https://around.nomoreparties.co/v1/web_es_12",{authorization:"39689808-444a-43ae-b51c-8f177d6060a9"});function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function a(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}var l=function(){return e=function e(t,r,n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._title=t.name,this._link=t.link,this._likes=Array.isArray(t.likes)?t.likes:[],this._cardId=t._id,this._templateSelector=r,this._element=this._getTemplate(),this._element.id=this._cardId,this._cardImage=this._element.querySelector(".card__photo"),this._cardTitle=this._element.querySelector(".card__info-name"),this._likeButton=this._element.querySelector(".card__like-button"),this._counterLikes=this._element.querySelector(".card__likes"),this._currentUser=n,this._handleCardLike=o,this._handleCardDelete=i,this._ownerId=t.owner._id,this._bindListeners(),this._updateLikeStatus()},t=[{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".card").cloneNode(!0)}},{key:"_bindListeners",value:function(){var e=this;this._likeButton.addEventListener("click",(function(){return e._handleLike()})),this._cardImage.addEventListener("click",(function(){return e._handleImageClick()})),this._currentUser===this._ownerId&&this._element.querySelector(".card__delete-button").addEventListener("click",(function(){return e._handleDelete()}))}},{key:"_handleLike",value:function(){var e=this,t=!this._likes.some((function(t){return t._id===e._currentUser}));this._toggleLike(t)}},{key:"_toggleLike",value:function(e){var t=this;this._handleCardLike(this._cardId,e).then((function(e){if(!Array.isArray(e.likes))throw new Error("Invalid updated likes: not an array");t._likes=e.likes,t._updateLikeStatus()})).catch((function(e){console.error("Error toggling like: ".concat(e))}))}},{key:"_handleDelete",value:function(){var e=this;i.deleteCard(this._cardId).then((function(){e._element.remove()})).catch((function(e){return console.error("Error:",e)}))}},{key:"_handleImageClick",value:function(){var e=this,t=document.querySelector("#popup_image-open"),r=document.querySelector("#popup__close-image"),n=document.querySelector(".popup__image-title"),o=document.querySelector(".popup__image"),i=document.querySelector("#popup-overlay-image");o.src=this._link,n.textContent=this._title,o.alt=this._title,t.classList.add("popup_opened"),r.addEventListener("click",(function(){t.classList.remove("popup_opened"),i.removeEventListener("click",e._handleOverlayClick)})),i.addEventListener("click",(function(){t.classList.remove("popup_opened"),i.removeEventListener("click",e._handleOverlayClick)}))}},{key:"_updateLikeStatus",value:function(){var e=this;Array.isArray(this._likes)&&(this._likes.some((function(t){return t._id===e._currentUser}))?this._likeButton.classList.add("card__like-button_active"):this._likeButton.classList.remove("card__like-button_active"),this._counterLikes.textContent=this._likes.length)}},{key:"generateCard",value:function(){return this._cardTitle.textContent=this._title,this._cardImage.src=this._link,this._cardImage.alt=this._title,this._updateLikeStatus(),this._element}}],t&&c(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function f(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:t+""}var y=function(){return e=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formElement=t,this._formSelector=r.formSelector,this._inputSelector=r.inputSelector,this._submitButtonSelector=r.submitButtonSelector,this._inactiveButtonClass=r.inactiveButtonClass,this._inputErrorClass=r.inputErrorClass,this._errorClass=r.errorClass,this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this.inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._setEventListeners()},(t=[{key:"_showInputError",value:function(e,t){e.classList.add(this._inputErrorClass),this._formElement.querySelector("#".concat(e.id,"-error")).textContent=t}},{key:"_hideInputError",value:function(e){e.classList.remove(this._inputErrorClass),this._formElement.querySelector("#".concat(e.id,"-error")).textContent=""}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_hasInvalidInput",value:function(){return this.inputList.some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput(this.inputList)?this._buttonElement.classList.add(this._inactiveButtonClass):this._buttonElement.classList.remove(this._inactiveButtonClass)}},{key:"_setEventListeners",value:function(){var e=this;this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this.inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))})),this._toggleButtonState()}}])&&p(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,h(n.key),n)}}function h(e){var t=function(e,t){if("object"!=v(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==v(t)?t:t+""}var m=function(){return e=function e(t,r){var n=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._items=n,this._renderer=o,this._cardsSelector=r},(t=[{key:"render",value:function(){var e=this;this._items.forEach((function(t){e._renderer(t)}))}},{key:"addItem",value:function(e){this._cardsSelector.prepend(e)}}])&&d(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,S(n.key),n)}}function S(e){var t=function(e,t){if("object"!=b(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==b(t)?t:t+""}var g=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.popupSelector=document.querySelector(t),this.popupCloseButton=this.popupSelector.querySelector(".popup__close-button")},(t=[{key:"open",value:function(){this.popupSelector.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose.bind(this))}},{key:"close",value:function(){this.popupSelector.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose.bind(this))}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleOverlayClick",value:function(e){return e.target.classList.contains("popup_opened")}},{key:"setEventListeners",value:function(){var e=this;this.popupCloseButton.addEventListener("click",(function(){e.close()})),this.popupSelector.addEventListener("click",(function(t){t.target===e.popupSelector&&e.close()}))}}])&&_(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,E(n.key),n)}}function E(e){var t=function(e,t){if("object"!=w(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:t+""}function O(e,t,r){return t=P(t),function(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,j()?Reflect.construct(t,r||[],P(e).constructor):t.apply(e,r))}function j(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(j=function(){return!!e})()}function L(){return L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},L.apply(this,arguments)}function P(e){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},P(e)}function C(e,t){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},C(e,t)}var q=function(e){function t(e,r){var n,o=r.handleFormAvatar;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=O(this,t,[e])).handleFormAvatar=o,n._buttonAvatar=n.popupSelector.querySelector("#popup-avatar__close"),n._spanError=n.popupSelector.querySelector("#popup__input_avatar-error"),n.formAvatar=n.popupSelector.querySelector("#popup-avatar__form"),n.buttonSaveAvatar=n.popupSelector.querySelector("#popup-avatar__button"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}(t,e),r=t,(n=[{key:"open",value:function(){L(P(t.prototype),"open",this).call(this),this.setEventListeners()}},{key:"setEventListeners",value:function(){L(P(t.prototype),"setEventListeners",this).call(this),this._buttonAvatar.addEventListener("click",(function(e){e.preventDefault()}))}},{key:"close",value:function(){L(P(t.prototype),"close",this).call(this),this.formAvatar.reset()}}])&&k(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(g);function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,B(n.key),n)}}function B(e){var t=function(e,t){if("object"!=I(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==I(t)?t:t+""}function D(e,t,r){return t=R(t),function(e,t){if(t&&("object"===I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,A()?Reflect.construct(t,r||[],R(e).constructor):t.apply(e,r))}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(A=function(){return!!e})()}function x(){return x="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},x.apply(this,arguments)}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}function U(e,t){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},U(e,t)}var N=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=D(this,t,[e])).handleFormSubmit=r,n.form=n.popupSelector.querySelector(".popup__form"),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(t,e),r=t,(n=[{key:"_getInputValues",value:function(){return{name:this.popupSelector.querySelector(".popup__input_title").value,link:this.popupSelector.querySelector("#popup__input_image").value}}},{key:"setEventListeners",value:function(){var e=this;x(R(t.prototype),"setEventListeners",this).call(this),this.form.addEventListener("submit",(function(t){t.preventDefault(),e.handleFormSubmit(t)}))}},{key:"close",value:function(){x(R(t.prototype),"close",this).call(this),this.form.reset()}}])&&T(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(g);function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function J(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,V(n.key),n)}}function V(e){var t=function(e,t){if("object"!=F(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==F(t)?t:t+""}function H(e,t,r){return t=G(t),function(e,t){if(t&&("object"===F(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,z()?Reflect.construct(t,r||[],G(e).constructor):t.apply(e,r))}function z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(z=function(){return!!e})()}function M(){return M="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=G(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},M.apply(this,arguments)}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}var Q,W=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=H(this,t,[e])).image=r.popupSelector.querySelector(".popup__image"),r.title=r.popupSelector.querySelector(".popup__image-title"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}(t,e),r=t,(n=[{key:"open",value:function(e,r){M(G(t.prototype),"open",this).call(this),this.image.src=e,this.title.textContent=r}}])&&J(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(g),X=document.querySelector(".profile__avatar"),Y=document.querySelector(".profile__name"),Z=document.querySelector(".profile__about"),$=document.querySelector(".profile__edit-button"),ee=document.querySelector(".popup__form"),te=document.querySelector("#form-cards"),re=document.querySelector(".popup__input_name"),ne=document.querySelector(".popup__input_about"),oe=document.querySelector(".profile__add-button"),ie=document.querySelector(".popup__input_title"),ue=document.querySelector("#popup__input_image"),ce=document.querySelector(".cards"),ae=document.getElementById("add-image-popup").querySelector(".popup__form"),le=document.querySelector(".profile__edit-icon"),se=document.querySelector("#popup-avatar__form"),pe=document.querySelector("#popup-avatar__button"),fe=document.querySelector("#popup-profile__button"),ye=document.querySelector("#popup-card__button");function ve(e){e.preventDefault();var t=re.value,r=ne.value;fe.textContent="Saving...",i.modifyUsersInfo(t,r).then((function(e){Y.textContent=null==e?void 0:e.name,Z.textContent=null==e?void 0:e.about,me.close()})).catch((function(e){console.error(e)})).finally((function(){fe.textContent="Save"}))}i.getUserInfo().then((function(e){Y.textContent=null==e?void 0:e.name,Z.textContent=null==e?void 0:e.about,X.src=null==e?void 0:e.avatar,Q=null==e?void 0:e._id,i.getInitialCards().then((function(e){var t=new m({items:e,renderer:function(e){var r=new l(e,".template-card",Q,Oe,je).generateCard();t.addItem(r)}},ce);t.render()}))}));var de=new g(".popup"),he=new N("#add-image-popup",(function(e){e.preventDefault(),he.close()})),me=new N(".popup",ve),be=new W("#popup_image-open"),_e=new q("#popup-avatar",{handleFormAvatar:Ee}),Se=document.querySelector("#popup-overlay-edit"),ge=document.querySelector("#popup-overlay-add"),we=document.querySelector("#popup-overlay-image"),ke=document.querySelector("#popup-overlay-avatar");function Ee(e){e.preventDefault();var t=se.querySelector(".popup__input").value;pe.textContent="Saving...",i.resetAvatar(t).then((function(e){X.src=null==e?void 0:e.avatar,_e.close(),pe.textContent="Save"}))}function Oe(e,t){return i.likeCard(e,t).then((function(e){return e})).catch((function(e){throw e}))}function je(e){i.deleteCard(e).then((function(){document.getElementById(e).remove()}))}function Le(e){e.target.classList.contains("popup__overlay")&&(de.close(),he.close(),be.close(),_e.close())}function Pe(e){"Escape"===e.key&&(de.close(),he.close(),be.close(),_e.close(),document.removeEventListener("keydown",Pe))}$.addEventListener("click",(function(){de.open(),i.getUserInfo().then((function(e){re.value=null==e?void 0:e.name,ne.value=null==e?void 0:e.about}))})),ee.addEventListener("submit",ve),oe.addEventListener("click",(function(){return he.open()})),ae.addEventListener("submit",(function(e){e.preventDefault(),ye.textContent="Saving...",ie.value&&ue.value&&i.getNewCard(ie.value,ue.value).then((function(e){var t=new l(e,".template-card",Q,Oe,je).generateCard();ce.prepend(t),ie.value="",ue.value="",he.close(),ye.textContent="Save"}))})),le.addEventListener("click",(function(){return _e.open()})),se.addEventListener("submit",Ee),he.setEventListeners(),Se.addEventListener("click",Le),ge.addEventListener("click",Le),we.addEventListener("click",Le),ke.addEventListener("click",Le),document.addEventListener("keydown",(function(e){return Pe(e)}));var Ce={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};new y(ee,Ce)._setEventListeners(),new y(te,Ce)._setEventListeners(),new y(se,Ce)._setEventListeners()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FDakNQLEVBQUk4TixXQUFXekMsR0FBVzlLLE1BQU8rSyxHQUFXL0ssT0FBT0csTUFBSyxTQUFDcU4sR0FDdkQsSUFPTUMsRUFQTyxJQUFJL0wsRUFDZjhMLEVBQ0EsaUJBQ0EzTCxFQUNBdUssR0FDQXJLLElBRTBCc0ssZUFDNUJyQixHQUFTMUMsUUFBUW1GLEdBQ2pCM0MsR0FBVzlLLE1BQVEsR0FDbkIrSyxHQUFXL0ssTUFBUSxHQUNuQnlNLEdBQWM3RCxRQUNkMEMsR0FBZXJHLFlBQWMsTUFDL0IsR0FFSixJQThEQWtHLEdBQW9CeEgsaUJBQWlCLFNBQVMsa0JBQU1nSixHQUFnQlcsTUFBTSxJQUMxRWxDLEdBQWtCekgsaUJBQWlCLFNBQVVpSixJQUU3Q0gsR0FBYzdDLG9CQUVkaUQsR0FBWWxKLGlCQUFpQixRQUFTd0osSUFDdENMLEdBQVduSixpQkFBaUIsUUFBU3dKLElBQ3JDcEksR0FBYXBCLGlCQUFpQixRQUFTd0osSUFDdkNKLEdBQWNwSixpQkFBaUIsUUFBU3dKLElBRXhDNUosU0FBU0ksaUJBQWlCLFdBQVcsU0FBQ3lKLEdBQUssT0FBS0MsR0FBYUQsRUFBTSxJQUVuRSxJQUFNekgsR0FBVyxDQUNmRyxhQUFjLGVBQ2RFLGNBQWUsZ0JBQ2ZFLHFCQUFzQixzQkFDdEJFLG9CQUFxQix5QkFDckJFLGdCQUFpQiwwQkFDakJFLFdBQVksd0JBR2MsSUFBSWYsRUFBY0MsR0FBYUMsSUFDdkNrQixxQkFDSyxJQUFJcEIsRUFBY2lGLEdBQWlCL0UsSUFDM0NrQixxQkFDVSxJQUFJcEIsRUFBYzJGLEdBQW1CekYsSUFDN0NrQixvQiIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0X2Fyb3VuZC8uL3NyYy91dGlscy9BcGkuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfYXJvdW5kLy4vc3JjL3NjcmlwdHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF9hcm91bmQvLi9zcmMvc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0X2Fyb3VuZC8uL3NyYy9zY3JpcHRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfYXJvdW5kLy4vc3JjL3NjcmlwdHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfYXJvdW5kLy4vc3JjL3NjcmlwdHMvUG9wdXBXaXRoQXZhdGFyLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0X2Fyb3VuZC8uL3NyYy9zY3JpcHRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfYXJvdW5kLy4vc3JjL3NjcmlwdHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfYXJvdW5kLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoYmFzZVVybCwgaGVhZGVycykge1xyXG4gICAgdGhpcy5iYXNlVXJsID0gYmFzZVVybDtcclxuICAgIHRoaXMuaGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L3VzZXJzL21lYCwgeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMgfSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIGlmICghcmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoYFNlcnZlciBlcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3I6XCIsIGVycm9yKSk7XHJcbiAgfVxyXG5cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9jYXJkc2AsIHsgaGVhZGVyczogdGhpcy5oZWFkZXJzIH0pXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKGBTZXJ2ZXIgZXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnJvcikgPT4gY29uc29sZS5lcnJvcihcIkVycm9yOlwiLCBlcnJvcikpO1xyXG4gIH1cclxuXHJcbiAgbW9kaWZ5VXNlcnNJbmZvKG5hbWUsIGFib3V0KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAuLi50aGlzLmhlYWRlcnMsXHJcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgYWJvdXQgfSksXHJcbiAgICB9KVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgaWYgKCFyZXMub2spIHRocm93IG5ldyBFcnJvcihgU2VydmVyIGVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvcjpcIiwgZXJyb3IpKTtcclxuICB9XHJcblxyXG4gIGdldE5ld0NhcmQobmFtZSwgbGluaykge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAuLi50aGlzLmhlYWRlcnMsXHJcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgIH0sXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KSxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKGBTZXJ2ZXIgZXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnJvcikgPT4gY29uc29sZS5lcnJvcihcIkVycm9yOlwiLCBlcnJvcikpO1xyXG4gIH1cclxuXHJcbiAgbGlrZUNhcmQoY2FyZElkLCBpc0xpa2VkKSB7XHJcbiAgICBjb25zdCBtZXRob2QgPSBpc0xpa2VkID8gXCJQVVRcIiA6IFwiREVMRVRFXCI7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogbWV0aG9kLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICB9KVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgaWYgKCFyZXMub2spIHRocm93IG5ldyBFcnJvcihgU2VydmVyIGVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3I6IGNhbid0IGFwcGx5IGxpa2VcIiwgZXJyb3IpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZUNhcmQoaWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLmJhc2VVcmx9L2NhcmRzLyR7aWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgIH0pXHJcbiAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICBpZiAoIXJlcy5vaykgdGhyb3cgbmV3IEVycm9yKGBTZXJ2ZXIgZXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnJvcikgPT4gY29uc29sZS5lcnJvcihcIkVycm9yOlwiLCBlcnJvcikpO1xyXG4gIH1cclxuXHJcbiAgcmVzZXRBdmF0YXIodXJsKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgLi4udGhpcy5oZWFkZXJzLFxyXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgICB9LFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhcjogdXJsIH0pLFxyXG4gICAgfSlcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIGlmICghcmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoYFNlcnZlciBlcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3I6XCIsIGVycm9yKSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgYXBpID0gbmV3IEFwaShcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvd2ViX2VzXzEyXCIsIHtcclxuICBhdXRob3JpemF0aW9uOiBcIjM5Njg5ODA4LTQ0NGEtNDNhZS1iNTFjLThmMTc3ZDYwNjBhOVwiLFxyXG59KTtcclxuIiwiaW1wb3J0IHsgYXBpIH0gZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBjYXJkRGF0YSxcclxuICAgIHRlbXBsYXRlU2VsZWN0b3IsXHJcbiAgICBjdXJyZW50VXNlcixcclxuICAgIGhhbmRsZUNhcmRMaWtlLFxyXG4gICAgaGFuZGxlQ2FyZERlbGV0ZVxyXG4gICkge1xyXG4gICAgdGhpcy5fdGl0bGUgPSBjYXJkRGF0YS5uYW1lO1xyXG4gICAgdGhpcy5fbGluayA9IGNhcmREYXRhLmxpbms7XHJcbiAgICB0aGlzLl9saWtlcyA9IEFycmF5LmlzQXJyYXkoY2FyZERhdGEubGlrZXMpID8gY2FyZERhdGEubGlrZXMgOiBbXTtcclxuICAgIHRoaXMuX2NhcmRJZCA9IGNhcmREYXRhLl9pZDtcclxuICAgIHRoaXMuX3RlbXBsYXRlU2VsZWN0b3IgPSB0ZW1wbGF0ZVNlbGVjdG9yO1xyXG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICB0aGlzLl9lbGVtZW50LmlkID0gdGhpcy5fY2FyZElkO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3Bob3RvXCIpO1xyXG4gICAgdGhpcy5fY2FyZFRpdGxlID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2luZm8tbmFtZVwiKTtcclxuICAgIHRoaXMuX2xpa2VCdXR0b24gPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XHJcbiAgICB0aGlzLl9jb3VudGVyTGlrZXMgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZXNcIik7XHJcbiAgICB0aGlzLl9jdXJyZW50VXNlciA9IGN1cnJlbnRVc2VyO1xyXG4gICAgdGhpcy5faGFuZGxlQ2FyZExpa2UgPSBoYW5kbGVDYXJkTGlrZTtcclxuICAgIHRoaXMuX2hhbmRsZUNhcmREZWxldGUgPSBoYW5kbGVDYXJkRGVsZXRlO1xyXG4gICAgdGhpcy5fb3duZXJJZCA9IGNhcmREYXRhLm93bmVyLl9pZDtcclxuICAgIHRoaXMuX2JpbmRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX3VwZGF0ZUxpa2VTdGF0dXMoKTtcclxuICB9XHJcblxyXG4gIF9nZXRUZW1wbGF0ZSgpIHtcclxuICAgIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX3RlbXBsYXRlU2VsZWN0b3IpXHJcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcclxuICAgIHJldHVybiBjYXJkVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gIH1cclxuXHJcbiAgX2JpbmRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLl9oYW5kbGVMaWtlKCkpO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrKCkpO1xyXG4gICAgaWYgKHRoaXMuX2N1cnJlbnRVc2VyID09PSB0aGlzLl9vd25lcklkKSB7XHJcbiAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xyXG4gICAgICBkZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZURlbGV0ZSgpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYW5kbGVMaWtlKCkge1xyXG4gICAgY29uc3QgaXNMaWtlZCA9IHRoaXMuX2xpa2VzLnNvbWUoKGxpa2UpID0+IGxpa2UuX2lkID09PSB0aGlzLl9jdXJyZW50VXNlcik7XHJcbiAgICBjb25zdCBsaWtlU3RhdHVzID0gIWlzTGlrZWQ7XHJcbiAgICB0aGlzLl90b2dnbGVMaWtlKGxpa2VTdGF0dXMpO1xyXG4gIH1cclxuXHJcbiAgX3RvZ2dsZUxpa2UobGlrZVN0YXR1cykge1xyXG4gICAgdGhpcy5faGFuZGxlQ2FyZExpa2UodGhpcy5fY2FyZElkLCBsaWtlU3RhdHVzKVxyXG4gICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcclxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocmVzcG9uc2UubGlrZXMpKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHVwZGF0ZWQgbGlrZXM6IG5vdCBhbiBhcnJheVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fbGlrZXMgPSByZXNwb25zZS5saWtlcztcclxuICAgICAgICB0aGlzLl91cGRhdGVMaWtlU3RhdHVzKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgdG9nZ2xpbmcgbGlrZTogJHtlcnJ9YCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZURlbGV0ZSgpIHtcclxuICAgIGFwaVxyXG4gICAgICAuZGVsZXRlQ2FyZCh0aGlzLl9jYXJkSWQpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3I6XCIsIGVycm9yKSk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlSW1hZ2VDbGljaygpIHtcclxuICAgIGNvbnN0IHBvcHVwSW1hZ2VPcGVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwb3B1cF9pbWFnZS1vcGVuXCIpO1xyXG4gICAgY29uc3QgY2xvc2VJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXBfX2Nsb3NlLWltYWdlXCIpO1xyXG4gICAgY29uc3QgcG9wdXBJbWFnZVRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2UtdGl0bGVcIik7XHJcbiAgICBjb25zdCBwb3B1cEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2VcIik7XHJcbiAgICBjb25zdCBvdmVybGF5SW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwLW92ZXJsYXktaW1hZ2VcIik7XHJcbiAgICBwb3B1cEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XHJcbiAgICBwb3B1cEltYWdlVGl0bGUudGV4dENvbnRlbnQgPSB0aGlzLl90aXRsZTtcclxuICAgIHBvcHVwSW1hZ2UuYWx0ID0gdGhpcy5fdGl0bGU7XHJcbiAgICBwb3B1cEltYWdlT3Blbi5jbGFzc0xpc3QuYWRkKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgY2xvc2VJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICBwb3B1cEltYWdlT3Blbi5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICBvdmVybGF5SW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZU92ZXJsYXlDbGljayk7XHJcbiAgICB9KTtcclxuICAgIG92ZXJsYXlJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICBwb3B1cEltYWdlT3Blbi5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfb3BlbmVkXCIpO1xyXG4gICAgICBvdmVybGF5SW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2hhbmRsZU92ZXJsYXlDbGljayk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF91cGRhdGVMaWtlU3RhdHVzKCkge1xyXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHRoaXMuX2xpa2VzKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBpc0xpa2VkID0gdGhpcy5fbGlrZXMuc29tZSgobGlrZSkgPT4gbGlrZS5faWQgPT09IHRoaXMuX2N1cnJlbnRVc2VyKTtcclxuICAgIGlmIChpc0xpa2VkKSB7XHJcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICAgIH1cclxuICAgIHRoaXMuX2NvdW50ZXJMaWtlcy50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcclxuICB9XHJcblxyXG4gIGdlbmVyYXRlQ2FyZCgpIHtcclxuICAgIHRoaXMuX2NhcmRUaXRsZS50ZXh0Q29udGVudCA9IHRoaXMuX3RpdGxlO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWx0ID0gdGhpcy5fdGl0bGU7XHJcbiAgICB0aGlzLl91cGRhdGVMaWtlU3RhdHVzKCk7XHJcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3IoZm9ybUVsZW1lbnQsIHNldHRpbmdzKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xyXG4gICAgdGhpcy5fZm9ybVNlbGVjdG9yID0gc2V0dGluZ3MuZm9ybVNlbGVjdG9yO1xyXG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHNldHRpbmdzLmlucHV0U2VsZWN0b3I7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xyXG4gICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3M7XHJcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3M7XHJcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gc2V0dGluZ3MuZXJyb3JDbGFzcztcclxuICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvclxyXG4gICAgKTtcclxuICAgIHRoaXMuaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgICAgdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIH1cclxuXHJcbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKSB7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gIH1cclxuXHJcbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgKTtcclxuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xyXG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XHJcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KHRoaXMuaW5wdXRMaXN0KSkge1xyXG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmlucHV0TGlzdC5mb3JFYWNoKChlbCkgPT4ge1xyXG4gICAgICBlbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShlbCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjYXJkc1NlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xyXG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgIHRoaXMuX2NhcmRzU2VsZWN0b3IgPSBjYXJkc1NlbGVjdG9yO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG4gICAgdGhpcy5faXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICB0aGlzLl9jYXJkc1NlbGVjdG9yLnByZXBlbmQoZWxlbWVudCk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLnBvcHVwU2VsZWN0b3IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5wb3B1cENsb3NlQnV0dG9uID0gdGhpcy5wb3B1cFNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIFwiLnBvcHVwX19jbG9zZS1idXR0b25cIlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIG9wZW4oKSB7XHJcbiAgICB0aGlzLnBvcHVwU2VsZWN0b3IuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcykpO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLnBvcHVwU2VsZWN0b3IuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX29wZW5lZFwiKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcykpO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZUVzY0Nsb3NlKGV2dCkge1xyXG4gICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2hhbmRsZU92ZXJsYXlDbGljayhldnQpIHtcclxuICAgIHJldHVybiBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX29wZW5lZFwiKTtcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5wb3B1cENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMucG9wdXBTZWxlY3Rvci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xyXG4gICAgICBpZiAoZXZ0LnRhcmdldCA9PT0gdGhpcy5wb3B1cFNlbGVjdG9yKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhBdmF0YXIgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3RvciwgeyBoYW5kbGVGb3JtQXZhdGFyIH0pIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5oYW5kbGVGb3JtQXZhdGFyID0gaGFuZGxlRm9ybUF2YXRhcjtcclxuICAgIHRoaXMuX2J1dHRvbkF2YXRhciA9IHRoaXMucG9wdXBTZWxlY3Rvci5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBcIiNwb3B1cC1hdmF0YXJfX2Nsb3NlXCJcclxuICAgICk7XHJcbiAgICB0aGlzLl9zcGFuRXJyb3IgPSB0aGlzLnBvcHVwU2VsZWN0b3IucXVlcnlTZWxlY3RvcihcclxuICAgICAgXCIjcG9wdXBfX2lucHV0X2F2YXRhci1lcnJvclwiXHJcbiAgICApO1xyXG4gICAgdGhpcy5mb3JtQXZhdGFyID0gdGhpcy5wb3B1cFNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtYXZhdGFyX19mb3JtXCIpO1xyXG4gICAgdGhpcy5idXR0b25TYXZlQXZhdGFyID0gdGhpcy5wb3B1cFNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIFwiI3BvcHVwLWF2YXRhcl9fYnV0dG9uXCJcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBvcGVuKCkge1xyXG4gICAgc3VwZXIub3BlbigpO1xyXG4gICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fYnV0dG9uQXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XHJcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICB0aGlzLmZvcm1BdmF0YXIucmVzZXQoKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcclxuICAgIHRoaXMuZm9ybSA9IHRoaXMucG9wdXBTZWxlY3Rvci5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xyXG4gIH1cclxuXHJcbiAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogdGhpcy5wb3B1cFNlbGVjdG9yLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2lucHV0X3RpdGxlXCIpLnZhbHVlLFxyXG4gICAgICBsaW5rOiB0aGlzLnBvcHVwU2VsZWN0b3IucXVlcnlTZWxlY3RvcihcIiNwb3B1cF9faW5wdXRfaW1hZ2VcIikudmFsdWUsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xyXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgdGhpcy5oYW5kbGVGb3JtU3VibWl0KGV2dCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgc3VwZXIuY2xvc2UoKTtcclxuICAgIHRoaXMuZm9ybS5yZXNldCgpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5pbWFnZSA9IHRoaXMucG9wdXBTZWxlY3Rvci5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZVwiKTtcclxuICAgIHRoaXMudGl0bGUgPSB0aGlzLnBvcHVwU2VsZWN0b3IucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW1hZ2UtdGl0bGVcIik7XHJcbiAgfVxyXG5cclxuICBvcGVuKGltYWdlU3JjLCB0aXRsZVRleHQpIHtcclxuICAgIHN1cGVyLm9wZW4oKTtcclxuICAgIHRoaXMuaW1hZ2Uuc3JjID0gaW1hZ2VTcmM7XHJcbiAgICB0aGlzLnRpdGxlLnRleHRDb250ZW50ID0gdGl0bGVUZXh0O1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgXCIuL3N0eWxlcy9pbmRleC5jc3NcIjtcclxuaW1wb3J0IENhcmQgZnJvbSBcIi4vc2NyaXB0cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuL3NjcmlwdHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi9zY3JpcHRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IFBvcHVwIGZyb20gXCIuL3NjcmlwdHMvUG9wdXAuanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEF2YXRhciBmcm9tIFwiLi9zY3JpcHRzL1BvcHVwV2l0aEF2YXRhci5qc1wiO1xyXG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi9zY3JpcHRzL1BvcHVwV2l0aEZvcm0uanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuL3NjcmlwdHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IHsgYXBpIH0gZnJvbSBcIi4vdXRpbHMvQXBpLmpzXCI7XHJcblxyXG5jb25zdCBpbWFnZVByb2ZpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcclxuY29uc3QgcHJvZmlsZU5hbWVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG5jb25zdCBwcm9maWxlQWJvdXRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hYm91dFwiKTtcclxuY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xyXG5cclxuY29uc3QgZm9ybUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19mb3JtXCIpO1xyXG5jb25zdCBmb3JtRWxlbWVudENhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2Zvcm0tY2FyZHNcIik7XHJcbmNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2lucHV0X25hbWVcIik7XHJcbmNvbnN0IGFib3V0SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbnB1dF9hYm91dFwiKTtcclxuY29uc3QgcHJvZmlsZUFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcclxuY29uc3QgdGl0bGVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2lucHV0X3RpdGxlXCIpO1xyXG5jb25zdCBpbWFnZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwb3B1cF9faW5wdXRfaW1hZ2VcIik7XHJcbmNvbnN0IGNhcmRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc1wiKTtcclxuY29uc3QgZ3JvdXBJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYWRkLWltYWdlLXBvcHVwXCIpO1xyXG5jb25zdCBmb3JtQ2FyZCA9IGdyb3VwSW1hZ2UucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcclxuY29uc3QgcHJvZmlsZUF2YXRhckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1pY29uXCIpO1xyXG5jb25zdCBmb3JtRWxlbWVudEF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtYXZhdGFyX19mb3JtXCIpO1xyXG5jb25zdCBidXR0b25TYXZlQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwb3B1cC1hdmF0YXJfX2J1dHRvblwiKTtcclxuY29uc3QgYnV0dG9uU2F2ZVByb2ZpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwLXByb2ZpbGVfX2J1dHRvblwiKTtcclxuY29uc3QgYnV0dG9uU2F2ZUNhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwLWNhcmRfX2J1dHRvblwiKTtcclxuXHJcbmxldCBjdXJyZW50VXNlcjtcclxuXHJcbmFwaS5nZXRVc2VySW5mbygpLnRoZW4oKHVzZXJEYXRhKSA9PiB7XHJcbiAgcHJvZmlsZU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gdXNlckRhdGE/Lm5hbWU7XHJcbiAgcHJvZmlsZUFib3V0RWxlbWVudC50ZXh0Q29udGVudCA9IHVzZXJEYXRhPy5hYm91dDtcclxuICBpbWFnZVByb2ZpbGUuc3JjID0gdXNlckRhdGE/LmF2YXRhcjtcclxuICBjdXJyZW50VXNlciA9IHVzZXJEYXRhPy5faWQ7XHJcblxyXG4gIGFwaS5nZXRJbml0aWFsQ2FyZHMoKS50aGVuKChjYXJkcykgPT4ge1xyXG4gICAgY29uc3Qgc2VjdGlvbiA9IG5ldyBTZWN0aW9uKFxyXG4gICAgICB7XHJcbiAgICAgICAgaXRlbXM6IGNhcmRzLFxyXG4gICAgICAgIHJlbmRlcmVyOiAoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxyXG4gICAgICAgICAgICBpdGVtLFxyXG4gICAgICAgICAgICBcIi50ZW1wbGF0ZS1jYXJkXCIsXHJcbiAgICAgICAgICAgIGN1cnJlbnRVc2VyLFxyXG4gICAgICAgICAgICBsaWtlQ2FyZCxcclxuICAgICAgICAgICAgaGFuZGxlQ2FyZERlbGV0ZVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcclxuICAgICAgICAgIHNlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgICAgY2FyZEFyZWFcclxuICAgICk7XHJcblxyXG4gICAgc2VjdGlvbi5yZW5kZXIoKTtcclxuICB9KTtcclxufSk7XHJcblxyXG5mdW5jdGlvbiBzZXRVc2VySW5mbygpIHtcclxuICBhcGkuZ2V0VXNlckluZm8oKS50aGVuKCh1c2VyRGF0YSkgPT4ge1xyXG4gICAgbmFtZUlucHV0LnZhbHVlID0gdXNlckRhdGE/Lm5hbWU7XHJcbiAgICBhYm91dElucHV0LnZhbHVlID0gdXNlckRhdGE/LmFib3V0O1xyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBuZXdOYW1lID0gbmFtZUlucHV0LnZhbHVlO1xyXG4gIGNvbnN0IG5ld0Fib3V0ID0gYWJvdXRJbnB1dC52YWx1ZTtcclxuICBidXR0b25TYXZlUHJvZmlsZS50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XHJcbiAgYXBpXHJcbiAgICAubW9kaWZ5VXNlcnNJbmZvKG5ld05hbWUsIG5ld0Fib3V0KVxyXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgcHJvZmlsZU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gZGF0YT8ubmFtZTtcclxuICAgICAgcHJvZmlsZUFib3V0RWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGE/LmFib3V0O1xyXG4gICAgICBlZGl0UHJvZmlsZVBvcHVwLmNsb3NlKCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgYnV0dG9uU2F2ZVByb2ZpbGUudGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jb25zdCBlZGl0UG9wdXAgPSBuZXcgUG9wdXAoXCIucG9wdXBcIik7XHJcblxyXG5jb25zdCBhZGRJbWFnZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXHJcbiAgXCIjYWRkLWltYWdlLXBvcHVwXCIsXHJcbiAgaGFuZGxlQWRkSW1hZ2VGb3JtU3VibWl0XHJcbik7XHJcblxyXG5jb25zdCBlZGl0UHJvZmlsZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXCIucG9wdXBcIiwgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xyXG5cclxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIiNwb3B1cF9pbWFnZS1vcGVuXCIpO1xyXG5cclxuY29uc3QgZWRpdEF2YXRhclBvcHVwID0gbmV3IFBvcHVwV2l0aEF2YXRhcihcIiNwb3B1cC1hdmF0YXJcIiwge1xyXG4gIGhhbmRsZUZvcm1BdmF0YXI6IGhhbmRsZUF2YXRhckZvcm1TdWJtaXQsXHJcbn0pO1xyXG5cclxuY29uc3Qgb3ZlcmxheUVkaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwLW92ZXJsYXktZWRpdFwiKTtcclxuY29uc3Qgb3ZlcmxheUFkZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtb3ZlcmxheS1hZGRcIik7XHJcbmNvbnN0IG92ZXJsYXlJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtb3ZlcmxheS1pbWFnZVwiKTtcclxuY29uc3Qgb3ZlcmxheUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcG9wdXAtb3ZlcmxheS1hdmF0YXJcIik7XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVBZGRJbWFnZUZvcm1TdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgYWRkSW1hZ2VQb3B1cC5jbG9zZSgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGJ1dHRvblNhdmVDYXJkLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcclxuICBpZiAodGl0bGVJbnB1dC52YWx1ZSAmJiBpbWFnZUlucHV0LnZhbHVlKSB7XHJcbiAgICBhcGkuZ2V0TmV3Q2FyZCh0aXRsZUlucHV0LnZhbHVlLCBpbWFnZUlucHV0LnZhbHVlKS50aGVuKChuZXdDYXJkKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgICAgICBuZXdDYXJkLFxyXG4gICAgICAgIFwiLnRlbXBsYXRlLWNhcmRcIixcclxuICAgICAgICBjdXJyZW50VXNlcixcclxuICAgICAgICBsaWtlQ2FyZCxcclxuICAgICAgICBoYW5kbGVDYXJkRGVsZXRlXHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnN0IG5ld0NhcmRFbGVtZW50ID0gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcclxuICAgICAgY2FyZEFyZWEucHJlcGVuZChuZXdDYXJkRWxlbWVudCk7XHJcbiAgICAgIHRpdGxlSW5wdXQudmFsdWUgPSBcIlwiO1xyXG4gICAgICBpbWFnZUlucHV0LnZhbHVlID0gXCJcIjtcclxuICAgICAgYWRkSW1hZ2VQb3B1cC5jbG9zZSgpO1xyXG4gICAgICBidXR0b25TYXZlQ2FyZC50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJGb3JtU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IG5ld0F2YXRhclVybCA9IGZvcm1FbGVtZW50QXZhdGFyLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2lucHV0XCIpLnZhbHVlO1xyXG4gIGJ1dHRvblNhdmVBdmF0YXIudGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xyXG4gIGFwaS5yZXNldEF2YXRhcihuZXdBdmF0YXJVcmwpLnRoZW4oKGRhdGEpID0+IHtcclxuICAgIGltYWdlUHJvZmlsZS5zcmMgPSBkYXRhPy5hdmF0YXI7XHJcbiAgICBlZGl0QXZhdGFyUG9wdXAuY2xvc2UoKTtcclxuICAgIGJ1dHRvblNhdmVBdmF0YXIudGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gbGlrZUNhcmQoY2FyZElkLCBpc0xpa2VkKSB7XHJcbiAgcmV0dXJuIGFwaVxyXG4gICAgLmxpa2VDYXJkKGNhcmRJZCwgaXNMaWtlZClcclxuICAgIC50aGVuKCh1cGRhdGVkQ2FyZCkgPT4ge1xyXG4gICAgICByZXR1cm4gdXBkYXRlZENhcmQ7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgdGhyb3cgZXJyO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNhcmREZWxldGUoY2FyZElkKSB7XHJcbiAgYXBpLmRlbGV0ZUNhcmQoY2FyZElkKS50aGVuKCgpID0+IHtcclxuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FyZElkKTtcclxuICAgIGNhcmRFbGVtZW50LnJlbW92ZSgpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVPdmVybGF5Q2xpY2soZXZlbnQpIHtcclxuICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19vdmVybGF5XCIpKSB7XHJcbiAgICBlZGl0UG9wdXAuY2xvc2UoKTtcclxuICAgIGFkZEltYWdlUG9wdXAuY2xvc2UoKTtcclxuICAgIGltYWdlUG9wdXAuY2xvc2UoKTtcclxuICAgIGVkaXRBdmF0YXJQb3B1cC5jbG9zZSgpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY2xvc2VQb3B1cHMoKSB7XHJcbiAgZWRpdFBvcHVwLmNsb3NlKCk7XHJcbiAgYWRkSW1hZ2VQb3B1cC5jbG9zZSgpO1xyXG4gIGltYWdlUG9wdXAuY2xvc2UoKTtcclxuICBlZGl0QXZhdGFyUG9wdXAuY2xvc2UoKTtcclxuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjbG9zZVdpdGhFc2MpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbG9zZVdpdGhFc2MoZXZlbnQpIHtcclxuICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICBjbG9zZVBvcHVwcygpO1xyXG4gIH1cclxufVxyXG5cclxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBlZGl0UG9wdXAub3BlbigpO1xyXG4gIHNldFVzZXJJbmZvKCk7XHJcbn0pO1xyXG5cclxuZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XHJcbnByb2ZpbGVBZGRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGFkZEltYWdlUG9wdXAub3BlbigpKTtcclxuZm9ybUNhcmQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBZGRDYXJkU3VibWl0KTtcclxucHJvZmlsZUF2YXRhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gZWRpdEF2YXRhclBvcHVwLm9wZW4oKSk7XHJcbmZvcm1FbGVtZW50QXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQXZhdGFyRm9ybVN1Ym1pdCk7XHJcblxyXG5hZGRJbWFnZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5vdmVybGF5RWRpdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlT3ZlcmxheUNsaWNrKTtcclxub3ZlcmxheUFkZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlT3ZlcmxheUNsaWNrKTtcclxub3ZlcmxheUltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVPdmVybGF5Q2xpY2spO1xyXG5vdmVybGF5QXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVPdmVybGF5Q2xpY2spO1xyXG5cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2ZW50KSA9PiBjbG9zZVdpdGhFc2MoZXZlbnQpKTtcclxuXHJcbmNvbnN0IHNldHRpbmdzID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIucG9wdXBfX2Zvcm1cIixcclxuICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX3NhdmUtYnV0dG9uXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fYnV0dG9uX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJyb3JfdmlzaWJsZVwiLFxyXG59O1xyXG5cclxuY29uc3QgdmFsaWRhdGVGb3JtUHJvZmlsZSA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1FbGVtZW50LCBzZXR0aW5ncyk7XHJcbnZhbGlkYXRlRm9ybVByb2ZpbGUuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbmNvbnN0IHZhbGlkYXRlRm9ybUNhcmQgPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtRWxlbWVudENhcmQsIHNldHRpbmdzKTtcclxudmFsaWRhdGVGb3JtQ2FyZC5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuY29uc3QgdmFsaWRhdGVGb3JtQXZhdGFyID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUVsZW1lbnRBdmF0YXIsIHNldHRpbmdzKTtcclxudmFsaWRhdGVGb3JtQXZhdGFyLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4iXSwibmFtZXMiOlsiYXBpIiwiQXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwia2V5IiwidmFsdWUiLCJmZXRjaCIsImNvbmNhdCIsInRoZW4iLCJyZXMiLCJvayIsIkVycm9yIiwic3RhdHVzIiwianNvbiIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiX29iamVjdFNwcmVhZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwibGluayIsImNhcmRJZCIsImlzTGlrZWQiLCJpZCIsInVybCIsImF2YXRhciIsImF1dGhvcml6YXRpb24iLCJDYXJkIiwiY2FyZERhdGEiLCJ0ZW1wbGF0ZVNlbGVjdG9yIiwiY3VycmVudFVzZXIiLCJoYW5kbGVDYXJkTGlrZSIsImhhbmRsZUNhcmREZWxldGUiLCJfdGl0bGUiLCJfbGluayIsIl9saWtlcyIsIkFycmF5IiwiaXNBcnJheSIsImxpa2VzIiwiX2NhcmRJZCIsIl9pZCIsIl90ZW1wbGF0ZVNlbGVjdG9yIiwiX2VsZW1lbnQiLCJfZ2V0VGVtcGxhdGUiLCJfY2FyZEltYWdlIiwicXVlcnlTZWxlY3RvciIsIl9jYXJkVGl0bGUiLCJfbGlrZUJ1dHRvbiIsIl9jb3VudGVyTGlrZXMiLCJfY3VycmVudFVzZXIiLCJfaGFuZGxlQ2FyZExpa2UiLCJfaGFuZGxlQ2FyZERlbGV0ZSIsIl9vd25lcklkIiwib3duZXIiLCJfYmluZExpc3RlbmVycyIsIl91cGRhdGVMaWtlU3RhdHVzIiwiZG9jdW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX3RoaXMiLCJhZGRFdmVudExpc3RlbmVyIiwiX2hhbmRsZUxpa2UiLCJfaGFuZGxlSW1hZ2VDbGljayIsIl9oYW5kbGVEZWxldGUiLCJfdGhpczIiLCJsaWtlU3RhdHVzIiwic29tZSIsImxpa2UiLCJfdG9nZ2xlTGlrZSIsIl90aGlzMyIsInJlc3BvbnNlIiwiZXJyIiwiX3RoaXM0IiwiZGVsZXRlQ2FyZCIsInJlbW92ZSIsIl90aGlzNSIsInBvcHVwSW1hZ2VPcGVuIiwiY2xvc2VJbWFnZSIsInBvcHVwSW1hZ2VUaXRsZSIsInBvcHVwSW1hZ2UiLCJvdmVybGF5SW1hZ2UiLCJzcmMiLCJ0ZXh0Q29udGVudCIsImFsdCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJfaGFuZGxlT3ZlcmxheUNsaWNrIiwiX3RoaXM2IiwibGVuZ3RoIiwiRm9ybVZhbGlkYXRvciIsImZvcm1FbGVtZW50Iiwic2V0dGluZ3MiLCJfZm9ybUVsZW1lbnQiLCJfZm9ybVNlbGVjdG9yIiwiZm9ybVNlbGVjdG9yIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2J1dHRvbkVsZW1lbnQiLCJpbnB1dExpc3QiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsIl9zZXRFdmVudExpc3RlbmVycyIsImlucHV0RWxlbWVudCIsImVycm9yTWVzc2FnZSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGlkZUlucHV0RXJyb3IiLCJfc2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oYXNJbnZhbGlkSW5wdXQiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsImZvckVhY2giLCJlbCIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJTZWN0aW9uIiwiX3JlZiIsImNhcmRzU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NhcmRzU2VsZWN0b3IiLCJpdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJwb3B1cENsb3NlQnV0dG9uIiwiX2hhbmRsZUVzY0Nsb3NlIiwiYmluZCIsImNsb3NlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhBdmF0YXIiLCJfUG9wdXAiLCJoYW5kbGVGb3JtQXZhdGFyIiwiX2NhbGxTdXBlciIsIl9idXR0b25BdmF0YXIiLCJfc3BhbkVycm9yIiwiZm9ybUF2YXRhciIsImJ1dHRvblNhdmVBdmF0YXIiLCJfaW5oZXJpdHMiLCJfZ2V0IiwiX2dldFByb3RvdHlwZU9mIiwicHJvdG90eXBlIiwiY2FsbCIsInNldEV2ZW50TGlzdGVuZXJzIiwicmVzZXQiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsImZvcm0iLCJQb3B1cFdpdGhJbWFnZSIsImltYWdlIiwidGl0bGUiLCJpbWFnZVNyYyIsInRpdGxlVGV4dCIsImltYWdlUHJvZmlsZSIsInByb2ZpbGVOYW1lRWxlbWVudCIsInByb2ZpbGVBYm91dEVsZW1lbnQiLCJwcm9maWxlRWRpdEJ1dHRvbiIsImZvcm1FbGVtZW50Q2FyZCIsIm5hbWVJbnB1dCIsImFib3V0SW5wdXQiLCJwcm9maWxlQWRkQnV0dG9uIiwidGl0bGVJbnB1dCIsImltYWdlSW5wdXQiLCJjYXJkQXJlYSIsImZvcm1DYXJkIiwiZ2V0RWxlbWVudEJ5SWQiLCJwcm9maWxlQXZhdGFyQnV0dG9uIiwiZm9ybUVsZW1lbnRBdmF0YXIiLCJidXR0b25TYXZlUHJvZmlsZSIsImJ1dHRvblNhdmVDYXJkIiwiaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQiLCJuZXdOYW1lIiwibmV3QWJvdXQiLCJtb2RpZnlVc2Vyc0luZm8iLCJkYXRhIiwiZWRpdFByb2ZpbGVQb3B1cCIsImZpbmFsbHkiLCJnZXRVc2VySW5mbyIsInVzZXJEYXRhIiwiZ2V0SW5pdGlhbENhcmRzIiwiY2FyZHMiLCJzZWN0aW9uIiwiY2FyZEVsZW1lbnQiLCJsaWtlQ2FyZCIsImdlbmVyYXRlQ2FyZCIsImFkZEl0ZW0iLCJyZW5kZXIiLCJlZGl0UG9wdXAiLCJhZGRJbWFnZVBvcHVwIiwiaW1hZ2VQb3B1cCIsImVkaXRBdmF0YXJQb3B1cCIsImhhbmRsZUF2YXRhckZvcm1TdWJtaXQiLCJvdmVybGF5RWRpdCIsIm92ZXJsYXlBZGQiLCJvdmVybGF5QXZhdGFyIiwibmV3QXZhdGFyVXJsIiwicmVzZXRBdmF0YXIiLCJ1cGRhdGVkQ2FyZCIsImhhbmRsZU92ZXJsYXlDbGljayIsImV2ZW50IiwiY2xvc2VXaXRoRXNjIiwib3BlbiIsImdldE5ld0NhcmQiLCJuZXdDYXJkIiwibmV3Q2FyZEVsZW1lbnQiXSwic291cmNlUm9vdCI6IiJ9